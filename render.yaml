services:
  # MySQL Database Service (Render's managed database)
  - type: ps
    name: veridia-mysql
    databaseName: veridia_hiring
    user: veridia
    region: oregon
    plan: free

  # Backend Spring Boot Service
  - type: web
    name: veridia-backend
    env: docker
    repo: https://github.com/Vinit-Sahare-Dev/Veridiahiringplatform.git
    dockerContext: ./backend
    dockerfilePath: ./backend/Dockerfile
    plan: free
    healthCheck:
      path: /api/health
      initialDelaySeconds: 60
      periodSeconds: 15
      timeoutSeconds: 10
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: production
      - key: DB_URL
        value: ${veridia-mysql.DATABASE_URL}
      - key: DB_USERNAME
        value: ${veridia-mysql.USERNAME}
      - key: DB_PASSWORD
        value: ${veridia-mysql.PASSWORD}
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_EXPIRATION
        value: "86400000"
      - key: SPRING_MAIL_HOST
        value: smtp.gmail.com
      - key: SPRING_MAIL_PORT
        value: "587"
      - key: SPRING_MAIL_USERNAME
        value: empsyncofficial@gmail.com
      - key: SPRING_MAIL_PASSWORD
        sync: false
      - key: SPRING_MAIL_FROM
        value: empsyncofficial@gmail.com
      - key: CORS_ALLOWED_ORIGINS
        value: https://veridia-frontend.onrender.com
    dependsOn:
      - veridia-mysql

  # Frontend React Service
  - type: web
    name: veridia-frontend
    env: static
    repo: https://github.com/Vinit-Sahare-Dev/Veridiahiringplatform.git
    rootDir: ./frontend
    buildCommand: npm run build
    publishPath: ./dist
    plan: free
    envVars:
      - key: VITE_API_BASE_URL
        value: https://veridia-backend.onrender.com
    dependsOn:
      - veridia-backend

# Global configuration
version: "1"
autoDeploy: true
